{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Interactive Economic Correlations Explorer",
    "subtitle": "Select variables and toggle regression line",
    "fontSize": 14
  },
  "width": 500,
  "height": 350,
  "data": {
    "values": [
      {"country": "UK", "gdp_per_capita": 42330, "life_expectancy": 81.3, "happiness": 6.9, "unemployment": 4.2, "region": "Europe"},
      {"country": "USA", "gdp_per_capita": 65280, "life_expectancy": 78.9, "happiness": 6.9, "unemployment": 3.9, "region": "Americas"},
      {"country": "Germany", "gdp_per_capita": 46260, "life_expectancy": 81.0, "happiness": 7.1, "unemployment": 3.0, "region": "Europe"},
      {"country": "France", "gdp_per_capita": 40490, "life_expectancy": 82.5, "happiness": 6.7, "unemployment": 7.3, "region": "Europe"},
      {"country": "Japan", "gdp_per_capita": 40250, "life_expectancy": 84.6, "happiness": 5.9, "unemployment": 2.6, "region": "Asia"},
      {"country": "Canada", "gdp_per_capita": 46330, "life_expectancy": 82.4, "happiness": 7.2, "unemployment": 5.0, "region": "Americas"},
      {"country": "Australia", "gdp_per_capita": 53830, "life_expectancy": 83.4, "happiness": 7.2, "unemployment": 3.5, "region": "Oceania"},
      {"country": "Italy", "gdp_per_capita": 33190, "life_expectancy": 83.5, "happiness": 6.4, "unemployment": 8.0, "region": "Europe"},
      {"country": "Spain", "gdp_per_capita": 29600, "life_expectancy": 83.6, "happiness": 6.4, "unemployment": 12.9, "region": "Europe"},
      {"country": "South Korea", "gdp_per_capita": 31490, "life_expectancy": 83.5, "happiness": 5.8, "unemployment": 2.9, "region": "Asia"},
      {"country": "Netherlands", "gdp_per_capita": 52300, "life_expectancy": 81.8, "happiness": 7.4, "unemployment": 3.4, "region": "Europe"},
      {"country": "Sweden", "gdp_per_capita": 54630, "life_expectancy": 82.8, "happiness": 7.4, "unemployment": 7.5, "region": "Europe"},
      {"country": "Norway", "gdp_per_capita": 75420, "life_expectancy": 82.4, "happiness": 7.4, "unemployment": 3.5, "region": "Europe"},
      {"country": "Denmark", "gdp_per_capita": 60170, "life_expectancy": 81.6, "happiness": 7.6, "unemployment": 4.9, "region": "Europe"},
      {"country": "Finland", "gdp_per_capita": 48790, "life_expectancy": 81.7, "happiness": 7.8, "unemployment": 6.8, "region": "Europe"},
      {"country": "Switzerland", "gdp_per_capita": 81870, "life_expectancy": 83.8, "happiness": 7.5, "unemployment": 4.2, "region": "Europe"},
      {"country": "New Zealand", "gdp_per_capita": 42020, "life_expectancy": 82.3, "happiness": 7.2, "unemployment": 3.3, "region": "Oceania"},
      {"country": "Singapore", "gdp_per_capita": 65640, "life_expectancy": 83.1, "happiness": 6.4, "unemployment": 2.1, "region": "Asia"},
      {"country": "Mexico", "gdp_per_capita": 9950, "life_expectancy": 75.1, "happiness": 6.3, "unemployment": 3.4, "region": "Americas"},
      {"country": "Brazil", "gdp_per_capita": 8920, "life_expectancy": 75.9, "happiness": 6.3, "unemployment": 8.0, "region": "Americas"}
    ]
  },
  "params": [
    {
      "name": "xVariable",
      "value": "gdp_per_capita",
      "bind": {
        "input": "select",
        "options": ["gdp_per_capita", "life_expectancy", "unemployment"],
        "labels": ["GDP per Capita ($)", "Life Expectancy (years)", "Unemployment Rate (%)"],
        "name": "X-Axis Variable: "
      }
    },
    {
      "name": "yVariable",
      "value": "happiness",
      "bind": {
        "input": "select",
        "options": ["happiness", "life_expectancy", "unemployment"],
        "labels": ["Happiness Score", "Life Expectancy (years)", "Unemployment Rate (%)"],
        "name": "Y-Axis Variable: "
      }
    },
    {
      "name": "showRegression",
      "value": true,
      "bind": {
        "input": "checkbox",
        "name": "Show Regression Line "
      }
    },
    {
      "name": "regionFilter",
      "value": "All",
      "bind": {
        "input": "select",
        "options": ["All", "Europe", "Americas", "Asia", "Oceania"],
        "name": "Filter by Region: "
      }
    }
  ],
  "transform": [
    {
      "filter": "regionFilter == 'All' || datum.region == regionFilter"
    },
    {
      "calculate": "datum[xVariable]",
      "as": "x"
    },
    {
      "calculate": "datum[yVariable]",
      "as": "y"
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "point",
        "size": 200,
        "filled": true,
        "opacity": 0.8
      },
      "encoding": {
        "x": {
          "field": "x",
          "type": "quantitative",
          "title": {"signal": "xVariable"},
          "scale": {"zero": false}
        },
        "y": {
          "field": "y",
          "type": "quantitative",
          "title": {"signal": "yVariable"},
          "scale": {"zero": false}
        },
        "color": {
          "field": "region",
          "type": "nominal",
          "title": "Region",
          "scale": {"scheme": "category10"}
        },
        "tooltip": [
          {"field": "country", "title": "Country"},
          {"field": "x", "type": "quantitative", "format": ",.0f", "title": {"signal": "xVariable"}},
          {"field": "y", "type": "quantitative", "format": ".1f", "title": {"signal": "yVariable"}}
        ]
      }
    },
    {
      "transform": [
        {
          "filter": "showRegression"
        },
        {
          "regression": "y",
          "on": "x",
          "method": "linear"
        }
      ],
      "mark": {
        "type": "line",
        "color": "red",
        "strokeWidth": 2,
        "strokeDash": [4, 4]
      },
      "encoding": {
        "x": {
          "field": "x",
          "type": "quantitative"
        },
        "y": {
          "field": "y",
          "type": "quantitative"
        }
      }
    }
  ]
}