{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Global Greenhouse Gas Emissions Evolution",
    "subtitle": "Interactive exploration of top emitters from 1970 to 2020",
    "fontSize": 18,
    "fontWeight": "bold",
    "anchor": "start",
    "color": "#2c3e50",
    "subtitleFontSize": 14,
    "subtitleColor": "#7f8c8d"
  },
  "data": {
    "url": "data/emissions_tidy.csv",
    "format": {"type": "csv"}
  },
  "params": [
    {
      "name": "yearSelect",
      "value": 1970,
      "bind": {
        "input": "range",
        "min": 1970,
        "max": 2020,
        "step": 5,
        "name": "Select Year: "
      }
    },
    {
      "name": "topN",
      "value": 10,
      "bind": {
        "input": "select",
        "options": [5, 10, 15, 20],
        "labels": ["Top 5", "Top 10", "Top 15", "Top 20"],
        "name": "Number of Countries: "
      }
    },
    {
      "name": "chartType",
      "value": "bar",
      "bind": {
        "input": "radio",
        "options": ["bar", "lollipop", "bubble"],
        "labels": ["Bar Chart", "Lollipop", "Bubble"],
        "name": "Chart Type: "
      }
    }
  ],
  "transform": [
    {"filter": "datum.Year == yearSelect"},
    {"calculate": "toNumber(datum.Emissions) / 1000", "as": "Emissions_Mt"},
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "Emissions_Mt", "order": "descending"}]
    },
    {"filter": "datum.rank <= topN"},
    {
      "calculate": "datum.rank == 1 ? 'ðŸ¥‡' : datum.rank == 2 ? 'ðŸ¥ˆ' : datum.rank == 3 ? 'ðŸ¥‰' : ''",
      "as": "medal"
    },
    {
      "calculate": "datum.Country + ' ' + datum.medal",
      "as": "country_label"
    },
    {
      "calculate": "format(datum.Emissions_Mt, ',.0f') + ' Mt COâ‚‚'",
      "as": "emissions_label"
    }
  ],
  "width": 700,
  "height": 450,
  "layer": [
    {
      "transform": [{"filter": "chartType == 'bar'"}],
      "layer": [
        {
          "mark": {
            "type": "bar",
            "cornerRadiusEnd": 4,
            "opacity": 0.9,
            "tooltip": true
          },
          "encoding": {
            "x": {
              "field": "Emissions_Mt",
              "type": "quantitative",
              "title": "Greenhouse Gas Emissions (Mt COâ‚‚-eq)",
              "axis": {"format": ",.0f", "gridOpacity": 0.3}
            },
            "y": {
              "field": "country_label",
              "type": "nominal",
              "sort": "-x",
              "title": null,
              "axis": {"labelFontSize": 12, "labelLimit": 200}
            },
            "color": {
              "field": "Emissions_Mt",
              "type": "quantitative",
              "scale": {"scheme": "redyellowgreen", "reverse": true},
              "legend": {"title": "Emissions (Mt)", "orient": "right"}
            },
            "tooltip": [
              {"field": "Country", "type": "nominal"},
              {"field": "rank", "type": "quantitative", "title": "Rank"},
              {"field": "Emissions_Mt", "type": "quantitative", "title": "Emissions (Mt)", "format": ",.1f"}
            ]
          }
        },
        {
          "mark": {"type": "text", "align": "left", "dx": 5, "fontWeight": "bold"},
          "encoding": {
            "x": {"field": "Emissions_Mt", "type": "quantitative"},
            "y": {"field": "country_label", "type": "nominal", "sort": "-x"},
            "text": {"field": "emissions_label"}
          }
        }
      ]
    },
    {
      "transform": [{"filter": "chartType == 'lollipop'"}],
      "layer": [
        {
          "mark": {"type": "rule", "strokeWidth": 2, "opacity": 0.7},
          "encoding": {
            "x": {"field": "Emissions_Mt", "type": "quantitative"},
            "y": {"field": "country_label", "type": "nominal", "sort": "-x"},
            "color": {"field": "Emissions_Mt", "type": "quantitative", "scale": {"scheme": "viridis"}}
          }
        },
        {
          "mark": {"type": "point", "size": 200, "filled": true},
          "encoding": {
            "x": {"field": "Emissions_Mt", "type": "quantitative"},
            "y": {"field": "country_label", "type": "nominal", "sort": "-x"},
            "color": {"field": "Emissions_Mt", "type": "quantitative", "scale": {"scheme": "viridis"}},
            "tooltip": [{"field": "Country", "type": "nominal"}, {"field": "Emissions_Mt", "format": ",.1f"}]
          }
        }
      ]
    },
    {
      "transform": [{"filter": "chartType == 'bubble'"}],
      "mark": {"type": "circle", "opacity": 0.8, "stroke": "white", "strokeWidth": 2},
      "encoding": {
        "x": {
          "field": "rank",
          "type": "quantitative",
          "title": "Ranking Position",
          "scale": {"reverse": true},
          "axis": {"tickMinStep": 1}
        },
        "y": {
          "field": "Emissions_Mt",
          "type": "quantitative",
          "title": "Emissions (Mt COâ‚‚-eq)",
          "scale": {"type": "log"}
        },
        "size": {
          "field": "Emissions_Mt",
          "type": "quantitative",
          "scale": {"range": [100, 2000]},
          "legend": null
        },
        "color": {
          "field": "Country",
          "type": "nominal",
          "scale": {"scheme": "tableau20"},
          "legend": {"title": "Country", "columns": 2}
        },
        "tooltip": [{"field": "Country", "type": "nominal"}, {"field": "rank", "type": "quantitative"}]
      }
    }
  ],
  "config": {
    "view": {"stroke": "transparent"},
    "axis": {"gridOpacity": 0.2, "titleFontWeight": "bold"}
  }
}