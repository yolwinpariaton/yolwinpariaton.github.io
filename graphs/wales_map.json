{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 400,
  "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/RDeconomist/RDeconomist.github.io/main/charts/maps/geoWalWards.json",
    "format": {"type": "topojson", "feature": "wards"}
  },
  "transform": [
    {
      "lookup": "properties.LAD13NM",
      "from": {
        "data": {
          "values": [
            {"name": "Isle of Anglesey", "pop": 70},
            {"name": "Gwynedd", "pop": 125},
            {"name": "Conwy", "pop": 118},
            {"name": "Denbighshire", "pop": 95},
            {"name": "Flintshire", "pop": 156},
            {"name": "Wrexham", "pop": 136},
            {"name": "Ceredigion", "pop": 71},
            {"name": "Pembrokeshire", "pop": 126},
            {"name": "Carmarthenshire", "pop": 188},
            {"name": "Swansea", "pop": 246},
            {"name": "Neath Port Talbot", "pop": 144},
            {"name": "Bridgend", "pop": 147},
            {"name": "The Vale of Glamorgan", "pop": 135},
            {"name": "Cardiff", "pop": 362},
            {"name": "Rhondda Cynon Taf", "pop": 241},
            {"name": "Caerphilly", "pop": 176},
            {"name": "Blaenau Gwent", "pop": 70},
            {"name": "Torfaen", "pop": 94},
            {"name": "Monmouthshire", "pop": 95},
            {"name": "Newport", "pop": 159},
            {"name": "Powys", "pop": 133},
            {"name": "Merthyr Tydfil", "pop": 60}
          ]
        },
        "key": "name",
        "fields": ["pop"]
      },
      "default": null
    },
    {
      "aggregate": [{
        "op": "mean",
        "field": "pop",
        "as": "pop_agg"
      }],
      "groupby": ["properties.LAD13NM"]
    }
  ],
  "projection": {"type": "mercator"},
  "mark": {
    "type": "geoshape",
    "stroke": "white",
    "strokeWidth": 0.5
  },
  "encoding": {
    "color": {
      "field": "pop_agg",
      "type": "quantitative",
      "scale": {
        "scheme": "blues",
        "domain": [60, 370]
      },
      "legend": {
        "title": "Population (thousands)",
        "orient": "bottom",
        "direction": "horizontal",
        "titleFontSize": 11,
        "labelFontSize": 10,
        "titleAnchor": "middle"
      }
    },
    "tooltip": [
      {"field": "properties.LAD13NM", "title": "Local Authority"},
      {"field": "pop_agg", "title": "Population (thousands)", "format": ".0f"}
    ]
  }
}