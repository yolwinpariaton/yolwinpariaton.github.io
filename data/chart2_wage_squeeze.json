  // Chart 2: Interactive Wage Squeeze (nicer + more impressive)
  safeEmbed("#chart2", {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": {
      "text": "Real Wage Squeeze by Sector",
      "subtitle": "Index (2020=100). Select a sector to highlight performance vs baseline."
    },

    "width": "container",
    "height": 450,
    "autosize": { "type": "fit", "contains": "padding" },

    "data": { "url": `${DATA_PATH}chart2_wage_squeeze.json` },
    "transform": [
      { "calculate": "toDate(datum.date)", "as": "date_parsed" }
    ],

    "params": [
      {
        "name": "sectorSelect",
        "value": "Public Sector",
        "bind": {
          "input": "select",
          "options": ["Public Sector", "Private Sector", "Finance", "Retail", "Healthcare"],
          "name": "Highlight sector: "
        }
      }
    ],

    "layer": [
      {
        "mark": { "type": "rule", "strokeDash": [6, 4], "strokeWidth": 2, "opacity": 0.6 },
        "encoding": { "y": { "datum": 100 } }
      },

      {
        "mark": { "type": "line", "strokeWidth": 2, "opacity": 0.25 },
        "encoding": {
          "x": {
            "field": "date_parsed",
            "type": "temporal",
            "title": "",
            "axis": { "format": "%b %Y", "labelAngle": -45, "grid": false }
          },
          "y": {
            "field": "squeeze_index",
            "type": "quantitative",
            "title": "Real Wage Index (2020=100)",
            "axis": { "grid": true }
          },
          "color": {
            "field": "sector",
            "type": "nominal",
            "legend": { "title": "Sector", "orient": "top" }
          },
          "tooltip": [
            { "field": "sector", "title": "Sector" },
            { "field": "date_parsed", "type": "temporal", "format": "%B %Y", "title": "Month" },
            { "field": "squeeze_index", "title": "Index", "format": ".1f" },
            { "field": "inflation", "title": "Inflation (%)", "format": ".1f" },
            { "field": "nominal_wage", "title": "Nominal Wage (£)", "format": ",.0f" },
            { "field": "real_wage", "title": "Real Wage (£)", "format": ",.0f" }
          ]
        }
      },

      {
        "transform": [{ "filter": "datum.sector == sectorSelect" }],
        "mark": { "type": "line", "strokeWidth": 4, "point": { "size": 70 } },
        "encoding": {
          "x": { "field": "date_parsed", "type": "temporal" },
          "y": { "field": "squeeze_index", "type": "quantitative" },
          "color": { "field": "sector", "type": "nominal", "legend": null },
          "tooltip": [
            { "field": "sector", "title": "Sector" },
            { "field": "date_parsed", "type": "temporal", "format": "%B %Y", "title": "Month" },
            { "field": "squeeze_index", "title": "Index", "format": ".1f" },
            { "field": "inflation", "title": "Inflation (%)", "format": ".1f" },
            { "field": "nominal_wage", "title": "Nominal Wage (£)", "format": ",.0f" },
            { "field": "real_wage", "title": "Real Wage (£)", "format": ",.0f" }
          ]
        }
      },

      {
        "transform": [
          { "filter": "datum.sector == sectorSelect" },
          { "window": [{ "op": "row_number", "as": "rn" }], "sort": [{ "field": "date_parsed", "order": "descending" }] },
          { "filter": "datum.rn == 1" },
          { "calculate": "'Latest: ' + format(datum.squeeze_index, '.1f')", "as": "kpi" }
        ],
        "mark": { "type": "text", "align": "left", "baseline": "top", "fontSize": 16, "fontWeight": "bold" },
        "encoding": {
          "x": { "value": 10 },
          "y": { "value": 10 },
          "text": { "field": "kpi" }
        }
      }
    ],

    "config": BASE_VL_CONFIG
  });
